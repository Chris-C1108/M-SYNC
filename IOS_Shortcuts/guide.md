# iOS 快捷指令配置指南

**M-SYNC iOS 快捷指令集成指南**

## 📱 概述

通过 iOS 快捷指令，您可以轻松地将 iPhone 上的文本、链接、验证码等内容发送到桌面端，实现跨设备的无缝同步。

## 🎯 支持的消息类型

### 1. 文本消息 (TEXT)
- **用途**: 发送普通文本、验证码、备注等
- **桌面端行为**: 自动复制到剪贴板
- **适用场景**: 验证码同步、文本片段共享

### 2. 链接消息 (URL)
- **用途**: 发送网页链接、应用链接等
- **桌面端行为**: 在默认浏览器中打开
- **适用场景**: 网页分享、链接收藏

### 3. 代码消息 (CODE)
- **用途**: 发送代码片段、配置文件等
- **桌面端行为**: 保持格式复制到剪贴板
- **适用场景**: 代码分享、配置同步

## 🔧 前置准备

### 1. 获取服务器信息
- **服务器地址**: `http://your-server.com:3000` (替换为您的实际服务器地址)
- **用户凭据**: 您的用户名和密码
- **访问令牌**: 通过登录获取的访问令牌

### 2. 获取访问令牌

#### 方法一: 通过API获取
```bash
curl -X POST http://your-server.com:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "your-username", "password": "your-password"}'
```

#### 方法二: 通过桌面客户端获取
1. 启动桌面客户端
2. 查看日志文件中的Token信息
3. 或在配置文件 `config/token.json` 中查看

## 📲 快捷指令创建步骤

### 1. 创建基础快捷指令

#### 步骤 1: 打开快捷指令应用
1. 在 iPhone 上打开「快捷指令」应用
2. 点击右上角的「+」创建新快捷指令

#### 步骤 2: 设置基本信息
1. 点击快捷指令名称，修改为「M-SYNC 发送文本」
2. 点击设置图标，选择合适的图标和颜色

#### 步骤 3: 添加操作

##### 3.1 获取输入内容
1. 搜索并添加「获取我的快捷指令」操作
2. 设置为「要求输入」
3. 输入类型选择「文本」
4. 提示文字设置为「请输入要发送的内容」

##### 3.2 设置服务器信息
1. 搜索并添加「文本」操作
2. 输入您的服务器地址: `http://your-server.com:3000/api/v1/messages/publish`

##### 3.3 设置访问令牌
1. 搜索并添加「文本」操作
2. 输入您的访问令牌 (128字符的十六进制字符串)

##### 3.4 构建请求数据
1. 搜索并添加「获取文本中的URL」操作
2. 搜索并添加「文本」操作，输入以下JSON模板:
```json
{
  "token": "提供的输入",
  "messageType": "TEXT",
  "content": "提供的输入"
}
```

##### 3.5 发送HTTP请求
1. 搜索并添加「获取URL内容」操作
2. 设置以下参数:
   - **URL**: 使用步骤3.2中的服务器地址
   - **方法**: POST
   - **请求体**: 使用步骤3.4中的JSON数据
   - **标头**: 
     - `Content-Type`: `application/json`

##### 3.6 处理响应
1. 搜索并添加「获取文本中的值」操作
2. 搜索并添加「显示通知」操作
3. 设置通知内容为「消息发送成功」

### 2. 创建专用快捷指令

#### 2.1 验证码快捷指令
```
快捷指令名称: M-SYNC 验证码
触发方式: 共享表单、Siri语音
消息类型: TEXT
特殊处理: 自动识别数字验证码
```

#### 2.2 链接分享快捷指令
```
快捷指令名称: M-SYNC 分享链接
触发方式: 共享表单
消息类型: URL
输入来源: Safari、其他应用的分享
```

#### 2.3 剪贴板同步快捷指令
```
快捷指令名称: M-SYNC 剪贴板
触发方式: 小组件、Siri语音
消息类型: TEXT
输入来源: 当前剪贴板内容
```

## 🔄 高级配置

### 1. 自动化触发

#### 1.1 接收短信时自动发送验证码
1. 打开「快捷指令」应用
2. 切换到「自动化」标签
3. 点击「+」创建个人自动化
4. 选择「消息」触发器
5. 设置条件: 包含「验证码」或数字模式
6. 添加「运行快捷指令」操作
7. 选择您创建的验证码快捷指令

#### 1.2 复制内容时自动同步
1. 创建个人自动化
2. 选择「剪贴板」触发器
3. 添加条件判断 (可选)
4. 运行剪贴板同步快捷指令

### 2. Siri 语音控制

#### 2.1 设置语音短语
1. 在快捷指令设置中
2. 点击「添加到Siri」
3. 录制语音短语，如:
   - "发送验证码"
   - "同步剪贴板"
   - "分享链接"

#### 2.2 语音指令示例
```
"嘿Siri，发送验证码" → 自动获取最新短信中的验证码并发送
"嘿Siri，同步剪贴板" → 发送当前剪贴板内容到桌面
"嘿Siri，分享这个链接" → 发送当前页面链接到桌面
```

## 🛠️ 故障排除

### 1. 常见问题

#### 问题 1: 请求失败 (401 Unauthorized)
**原因**: 访问令牌无效或过期
**解决方案**: 
1. 重新获取访问令牌
2. 检查令牌格式 (应为128字符十六进制)
3. 确认用户名密码正确

#### 问题 2: 请求失败 (404 Not Found)
**原因**: 服务器地址错误
**解决方案**:
1. 检查服务器地址格式
2. 确认服务器正在运行
3. 检查网络连接

#### 问题 3: 桌面端未收到消息
**原因**: 桌面客户端未连接或Token不匹配
**解决方案**:
1. 检查桌面客户端连接状态
2. 确认使用相同的用户账户
3. 重启桌面客户端

### 2. 调试技巧

#### 2.1 启用详细日志
在快捷指令中添加「显示通知」操作来显示:
- 请求URL
- 请求数据
- 响应状态
- 错误信息

#### 2.2 测试连接
创建简单的测试快捷指令:
```json
{
  "token": "your-token",
  "messageType": "TEXT",
  "content": "测试消息"
}
```

## 📋 快捷指令模板

### 模板 1: 基础文本发送
```
操作流程:
1. 获取输入 (文本)
2. 构建JSON请求
3. 发送HTTP POST请求
4. 显示结果通知
```

### 模板 2: 智能验证码识别
```
操作流程:
1. 获取最新短信
2. 正则匹配验证码
3. 构建JSON请求 (messageType: TEXT)
4. 发送HTTP POST请求
5. 显示成功通知
```

### 模板 3: 链接分享
```
操作流程:
1. 获取共享输入 (URL)
2. 验证URL格式
3. 构建JSON请求 (messageType: URL)
4. 发送HTTP POST请求
5. 显示成功通知
```

## 🔐 安全建议

### 1. 令牌安全
- 不要在快捷指令中硬编码令牌
- 定期更换访问令牌
- 使用快捷指令的「询问输入」功能

### 2. 网络安全
- 在生产环境中使用HTTPS
- 考虑使用VPN保护通信
- 定期检查服务器安全设置

### 3. 隐私保护
- 谨慎处理敏感信息
- 避免自动发送私人内容
- 定期清理快捷指令日志

## 📞 技术支持

如果您在配置过程中遇到问题:

1. **查看日志**: 检查桌面客户端和服务器日志
2. **测试连接**: 使用curl命令测试API连接
3. **联系支持**: 创建GitHub Issue或发送邮件

---

**配置完成后，您就可以享受 iPhone 和桌面端之间的无缝消息同步体验！**
