# M-SYNC 项目结构说明

**更新时间**: 2025年7月28日

## 📁 项目目录结构

```
M-SYNC/
├── 📄 README.md                           # 项目主文档
├── 📄 M-SYNC项目开发进度总结.md            # 开发进度总结
├── 📄 M-SYNC统一Token认证系统变更总结.md   # Token系统变更记录
├── 📄 需求_优化版.md                       # 需求和架构设计文档
├── 📄 项目结构说明.md                      # 本文档
│
├── 🗂️ .ai-rules/                          # AI助手规则配置
│   ├── product.md                         # 产品愿景定义
│   ├── structure.md                       # 项目结构规则
│   └── tech.md                            # 技术架构规则
│
├── 🗂️ server/                             # 消息代理服务端
│   ├── 📄 README.md                       # 服务端文档
│   ├── 📄 开发计划.md                      # 服务端开发计划
│   ├── 📄 项目完成总结.md                  # 服务端完成总结
│   ├── 📄 API测试示例.md                   # API使用示例
│   ├── 📄 Token安全最佳实践.md             # Token安全指南
│   ├── 📄 统一Token认证设计.md             # Token认证设计文档
│   │
│   ├── 📦 package.json                    # 依赖配置
│   ├── 🔧 .env.example                    # 环境变量模板
│   │
│   ├── 🗂️ config/                         # 配置文件
│   │   ├── default.json                   # 默认配置
│   │   └── production.json                # 生产环境配置
│   │
│   ├── 🗂️ src/                            # 源代码
│   │   ├── 📄 app.js                      # 应用入口
│   │   │
│   │   ├── 🗂️ controllers/                # 控制器层
│   │   │   ├── AuthController.js          # 认证控制器
│   │   │   ├── MessageController.js       # 消息控制器
│   │   │   └── TokenController.js         # Token控制器
│   │   │
│   │   ├── 🗂️ services/                   # 服务层
│   │   │   ├── AuthenticationService.js   # 认证服务
│   │   │   ├── MessageBrokerService.js    # 消息代理服务
│   │   │   └── WebSocketService.js        # WebSocket服务
│   │   │
│   │   ├── 🗂️ models/                     # 数据模型
│   │   │   ├── User.js                    # 用户模型
│   │   │   ├── AccessToken.js             # 访问令牌模型
│   │   │   └── Message.js                 # 消息模型
│   │   │
│   │   ├── 🗂️ middleware/                 # 中间件
│   │   │   ├── auth.js                    # 认证中间件
│   │   │   ├── cors.js                    # CORS中间件
│   │   │   ├── rateLimit.js               # 限流中间件
│   │   │   └── validation.js              # 验证中间件
│   │   │
│   │   ├── 🗂️ routes/                     # 路由定义
│   │   │   ├── index.js                   # 路由入口
│   │   │   └── api/                       # API路由
│   │   │       ├── auth.js                # 认证路由
│   │   │       ├── messages.js            # 消息路由
│   │   │       └── tokens.js              # Token路由
│   │   │
│   │   ├── 🗂️ database/                   # 数据库相关
│   │   │   ├── connection.js              # 数据库连接
│   │   │   └── migrations/                # 数据库迁移
│   │   │
│   │   └── 🗂️ utils/                      # 工具函数
│   │       ├── logger.js                  # 日志工具
│   │       ├── validator.js               # 验证工具
│   │       ├── crypto.js                  # 加密工具
│   │       └── ServiceRegistry.js         # 服务注册表
│   │
│   ├── 🗂️ data/                           # 数据存储
│   │   └── database.sqlite                # SQLite数据库文件
│   │
│   ├── 🗂️ logs/                           # 日志文件
│   │   ├── app.log                        # 应用日志
│   │   └── error.log                      # 错误日志
│   │
│   ├── 🗂️ public/                         # 静态资源
│   │   └── index.html                     # 默认页面
│   │
│   └── 🗂️ scripts/                        # 脚本文件
│       └── init-db.js                     # 数据库初始化脚本
│
└── 🗂️ client/                             # 桌面消息订阅端
    ├── 📄 README.md                       # 客户端文档
    ├── 📄 开发计划.md                      # 客户端开发计划
    │
    ├── 📦 package.json                    # 依赖配置
    │
    ├── 🗂️ config/                         # 配置文件
    │   ├── default.json                   # 默认配置
    │   ├── config.json                    # 运行时配置
    │   └── token.json                     # Token存储
    │
    ├── 🗂️ src/                            # 源代码
    │   ├── 📄 index.js                    # 应用入口
    │   │
    │   ├── 🗂️ core/                       # 核心模块
    │   │   ├── ConfigManager.js           # 配置管理器
    │   │   ├── MessageSubscriberClient.js # 消息订阅客户端
    │   │   └── WebSocketConnectionManager.js # WebSocket连接管理器
    │   │
    │   ├── 🗂️ services/                   # 服务层
    │   │   ├── TokenManager.js            # Token管理器
    │   │   ├── ClipboardManager.js        # 剪贴板管理器
    │   │   ├── BrowserLauncher.js         # 浏览器启动器
    │   │   └── SystemNotifier.js          # 系统通知器
    │   │
    │   ├── 🗂️ handlers/                   # 消息处理器
    │   │   ├── MessageHandlerRegistry.js  # 处理器注册表
    │   │   ├── TextMessageHandler.js      # 文本消息处理器
    │   │   └── UrlMessageHandler.js       # URL消息处理器
    │   │
    │   └── 🗂️ utils/                      # 工具函数
    │       ├── logger.js                  # 日志工具
    │       └── systemInfo.js              # 系统信息工具
    │
    ├── 🗂️ assets/                         # 资源文件
    │   └── icons/                         # 图标文件
    │
    └── 🗂️ logs/                           # 日志文件
        ├── subscriber.log                 # 订阅者日志
        └── error.log                      # 错误日志
```

## 📋 文件说明

### 🗂️ 根目录文件
- **README.md**: 项目主文档，包含快速开始、架构说明、使用指南
- **M-SYNC项目开发进度总结.md**: 详细的开发进度和完成状态
- **M-SYNC统一Token认证系统变更总结.md**: Token系统的设计变更记录
- **需求_优化版.md**: 原始需求分析和架构设计文档
- **项目结构说明.md**: 本文档，项目结构的详细说明

### 🗂️ .ai-rules/ 目录
AI助手的配置规则，用于指导AI在项目中的行为：
- **product.md**: 定义产品愿景和核心功能
- **structure.md**: 定义项目结构和文件组织规则
- **tech.md**: 定义技术架构和实现指南

### 🗂️ server/ 目录
消息代理服务端，负责消息路由和分发：
- **核心服务**: WebSocket服务、消息代理服务、认证服务
- **数据模型**: 用户、Token、消息的数据模型
- **API接口**: RESTful API，支持认证、Token管理、消息发布
- **安全机制**: Token认证、权限控制、数据加密

### 🗂️ client/ 目录
桌面消息订阅端，负责接收和处理消息：
- **核心模块**: 消息订阅客户端、WebSocket连接管理器
- **服务层**: Token管理、剪贴板管理、浏览器启动、系统通知
- **消息处理**: 支持TEXT、CODE、URL三种消息类型
- **系统集成**: 跨平台的系统服务集成

## 🔧 配置文件说明

### 服务端配置
- **config/default.json**: 默认配置，包含服务器端口、数据库配置等
- **config/production.json**: 生产环境配置
- **.env**: 环境变量，包含敏感信息如数据库密码、JWT密钥等

### 客户端配置
- **config/default.json**: 默认配置，包含服务器地址、重连参数等
- **config/config.json**: 运行时配置
- **config/token.json**: Token存储文件

## 📊 代码组织原则

### 1. 分层架构
- **控制器层**: 处理HTTP请求和响应
- **服务层**: 业务逻辑处理
- **数据层**: 数据模型和数据库操作
- **工具层**: 通用工具函数

### 2. 模块化设计
- 每个模块职责单一，接口清晰
- 模块间通过依赖注入进行解耦
- 支持单元测试和集成测试

### 3. 配置管理
- 环境相关配置通过配置文件管理
- 敏感信息通过环境变量管理
- 支持不同环境的配置切换

### 4. 日志管理
- 结构化日志记录
- 不同级别的日志分离
- 日志轮转和清理机制

## 🚀 部署结构

### 开发环境
```
开发机器
├── server/ (端口3000)
└── client/ (本地运行)
```

### 生产环境
```
服务器
├── M-SYNC服务 (Docker容器)
├── 数据库 (PostgreSQL)
├── 反向代理 (Nginx)
└── 监控系统 (可选)

客户端设备
└── M-SYNC客户端 (可执行文件)
```

---

**维护说明**: 本文档随项目结构变化而更新，确保与实际项目结构保持一致。
